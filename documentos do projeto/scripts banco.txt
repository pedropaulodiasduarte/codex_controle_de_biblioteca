CREATE DATABASE codexcb;

CREATE TABLE leitor (
id int auto_increment primary key,
nome VARCHAR(50) NOT NULL,
cpf VARCHAR(11) UNIQUE,
endereco TEXT NOT NULL,
telefone VARCHAR(18),
email VARCHAR(70)
);

CREATE TABLE localizacao(
id int auto_increment primary key,
corredor int not null,
prateleira int not null,
estante int not null,
sala int not null,
andar int not null
);

CREATE TABLE livro(
id int auto_increment primary key,
titulo varchar (80) not null,
autor varchar (80) not null,
isbnCodigo varchar (20) not null unique,
idioma varchar (35) not null,
editora varchar (100) not null,
dataPublicacao date not null,
copia int not null,
genero varchar (50) not null,
idLocalizacao int not null,
foreign key (idLocalizacao) references localizacao (id)
);

create table emprestimo (
id int auto_increment primary key,
isbncodigofk varchar (20) not null,
cpffk varchar(14) not null,
dataemprestimo date not null,
dataDevolucao date not null,
status varchar(25) not null,
foreign key (isbncodigofk) references livro (isbncodigo ),
foreign key (cpffk) references leitor (cpf)
);


update livro set titulo = ?, autor = ?, idioma = ?, editora = ?, datapublicacao = ?, copia = ?, genero = ?, idLocalizacao = ? where isbncodigo = ?; 
select count(*) from emprestimo where isbncodigo = '1' and idLeitor=1 and status = 'pendente';
select count(*) from emprestimo where isbncodigo = '1' and idLeitor=1 and status = 'devolvido';
select count(*) from emprestimo;
select * from leitor;
select * from leitor where id = 1;
select * from livro where isbncodigo = 4639456716386;
select emprestimo.id, livro.titulo, leitor.nome, emprestimo.dataemprestimo, emprestimo.datadevolucao, emprestimo.status from emprestimo inner join leitor on emprestimo.cpffk = leitor.cpf inner join livro on emprestimo.isbncodigofk = livro.isbncodigo;
select emprestimo.id, livro.titulo, leitor.nome, emprestimo.dataemprestimo, emprestimo.datadevolucao, emprestimo.status from emprestimo inner join leitor on emprestimo.cpffk = leitor.cpf inner join livro on emprestimo.isbncodigofk = livro.isbncodigo where emprestimo.id = 2 and emprestimo.status = "Pendente";
update livro set titulo = ?, autor = ?, editora = ?, datapublicacao = '2024-01-03'  where isbncodigo ='1'; 
select emprestimo.id, livro.titulo, leitor.nome, emprestimo.dataemprestimo, emprestimo.datadevolucao, emprestimo.status from emprestimo inner join leitor on emprestimo.cpffk = leitor.cpf inner join livro on emprestimo.isbncodigofk = livro.isbncodigo where emprestimo.status = ?;


SELECT l.nome, l.cpf, l.id, l.telefone, COALESCE((SELECT e.status FROM emprestimo e WHERE e.cpffk = l.cpf ORDER BY e.dataEmprestimo DESC, e.id DESC LIMIT 1), 'Não há registro') AS statusultimoemprestimo FROM leitor l ORDER BY l.nome;

select * from leitor where nome like ?; 

select emprestimo.id, livro.titulo, leitor.nome, emprestimo.dataemprestimo, emprestimo.datadevolucao, emprestimo.status from emprestimo inner join leitor on emprestimo.cpffk = leitor.cpf inner join livro on emprestimo.isbncodigofk = livro.isbncodigo where nome like ?;

update emprestimo set status = ?, dataDevolucao = ? where id = ? and status = ?; 
update emprestimo set status = "Devolvido" where id = 1 and status = "Pendente"; 
update emprestimo set status = "Devolvido", dataDevolucao = "2025-09-09" where id = 1 and status = "Pendente"; 




*Base de teste
**livros
INSERT INTO livro (titulo, autor, isbnCodigo, idioma, editora, dataPublicacao, copia, genero, idLocalizacao) VALUES ('Dom Quixote', 'Miguel de Cervantes', '9788574480011', 'Português', 'Editora A', '1605-01-16', 10, 'Romance Clássico', 1),('A Metamorfose', 'Franz Kafka', '9788574480028', 'Português', 'Editora B', '1915-12-01', 10, 'Ficção Filosófica', 1),('1984', 'George Orwell', '9788574480035', 'Inglês', 'Editora C', '1949-06-08', 10, 'Distopia', 2),('Admirável Mundo Novo', 'Aldous Huxley', '9788574480042', 'Inglês', 'Editora D', '1932-10-18', 10, 'Distopia', 2),('O Processo', 'Franz Kafka', '9788574480059', 'Português', 'Editora E', '1925-04-26', 10, 'Ficção Filosófica', 3),('Cem Anos de Solidão', 'Gabriel García Márquez', '9788574480066', 'Espanhol', 'Editora F', '1967-05-30', 10, 'Realismo Mágico', 3),('O Sol é Para Todos', 'Harper Lee', '9788574480073', 'Inglês', 'Editora G', '1960-07-11', 10, 'Ficção Social', 4),('Crime e Castigo', 'Fiódor Dostoiévski', '9788574480080', 'Russo', 'Editora H', '1866-12-01', 10, 'Romance Psicológico', 4),('Guerra e Paz', 'Liev Tolstói', '9788574480097', 'Russo', 'Editora I', '1869-01-01', 10, 'Romance Histórico', 5),('A Divina Comédia', 'Dante Alighieri', '9788574480103', 'Italiano', 'Editora J', '1320-09-14', 10, 'Poesia Épica', 5),('Moby Dick', 'Herman Melville', '9788574480110', 'Inglês', 'Editora K', '1851-10-18', 10, 'Aventura', 6),('Orgulho e Preconceito', 'Jane Austen', '9788574480127', 'Inglês', 'Editora L', '1813-01-28', 10, 'Romance', 6),('O Retrato de Dorian Gray', 'Oscar Wilde', '9788574480134', 'Inglês', 'Editora M', '1890-07-01', 10, 'Gótico', 7),('Viagem ao Centro da Terra', 'Júlio Verne', '9788574480141', 'Francês', 'Editora N', '1864-11-25', 10, 'Ficção Científica', 7),('Vinte Mil Léguas Submarinas', 'Júlio Verne', '9788574480158', 'Francês', 'Editora O', '1870-03-20', 10, 'Aventura', 8),('O Conde de Monte Cristo', 'Alexandre Dumas', '9788574480165', 'Francês', 'Editora P', '1844-08-01', 10, 'Romance de Vingança', 8),('Os Miseráveis', 'Victor Hugo', '9788574480172', 'Francês', 'Editora Q', '1862-04-03', 10, 'Romance Histórico', 9),('O Morro dos Ventos Uivantes', 'Emily Brontë', '9788574480189', 'Inglês', 'Editora R', '1847-12-01', 10, 'Romance Gótico', 9),('O Grande Gatsby', 'F. Scott Fitzgerald', '9788574480196', 'Inglês', 'Editora S', '1925-04-10', 10, 'Ficção Moderna', 10),('As Vinhas da Ira', 'John Steinbeck', '9788574480202', 'Inglês', 'Editora T', '1939-04-14', 10, 'Ficção Social', 10),('O Senhor dos Anéis: A Sociedade do Anel', 'J.R.R. Tolkien', '9788574480219', 'Inglês', 'Editora U', '1954-07-29', 10, 'Fantasia Épica', 11),('O Hobbit', 'J.R.R. Tolkien', '9788574480226', 'Inglês', 'Editora V', '1937-09-21', 10, 'Fantasia', 11),('Harry Potter e a Pedra Filosofal', 'J.K. Rowling', '9788574480233', 'Inglês', 'Editora W', '1997-06-26', 10, 'Fantasia', 12),('Crônicas de Nárnia: O Leão, a Feiticeira e o Guarda-Roupa', 'C.S. Lewis', '9788574480240', 'Inglês', 'Editora X', '1950-10-16', 10, 'Fantasia', 12),('O Nome do Vento', 'Patrick Rothfuss', '9788574480257', 'Inglês', 'Editora Y', '2007-03-27', 10, 'Fantasia', 13),('Mistborn: O Império Final', 'Brandon Sanderson', '9788574480264', 'Inglês', 'Editora Z', '2006-07-17', 10, 'Fantasia', 13),('Fundação', 'Isaac Asimov', '9788574480271', 'Inglês', 'Editora AA', '1951-04-01', 10, 'Ficção Científica', 14),('Duna', 'Frank Herbert', '9788574480288', 'Inglês', 'Editora BB', '1965-08-01', 10, 'Ficção Científica', 14),('Neuromancer', 'William Gibson', '9788574480295', 'Inglês', 'Editora CC', '1984-07-01', 10, 'Cyberpunk', 15),('Eu, Robô', 'Isaac Asimov', '9788574480301', 'Inglês', 'Editora DD', '1950-12-02', 10, 'Ficção Científica', 15),('Os Jogos Vorazes', 'Suzanne Collins', '9788574480318', 'Inglês', 'Editora EE', '2008-09-14', 10, 'Young Adult', 16),('Divergente', 'Veronica Roth', '9788574480325', 'Inglês', 'Editora FF', '2011-04-25', 10, 'Young Adult', 16),('Extraordinário', 'R.J. Palacio', '9788574480332', 'Inglês', 'Editora GG', '2012-02-14', 10, 'Infantil', 17),('O Pequeno Príncipe', 'Antoine de Saint-Exupéry', '9788574480349', 'Francês', 'Editora HH', '1943-04-06', 10, 'Infantil', 17),('A Culpa é das Estrelas', 'John Green', '9788574480356', 'Inglês', 'Editora II', '2012-01-10', 10, 'Romance Jovem', 18),('Se Eu Ficar', 'Gayle Forman', '9788574480363', 'Inglês', 'Editora JJ', '2009-04-02', 10, 'Romance Jovem', 18),('O Código Da Vinci', 'Dan Brown', '9788574480370', 'Inglês', 'Editora KK', '2003-03-18', 10, 'Thriller', 19),('Anjos e Demônios', 'Dan Brown', '9788574480387', 'Inglês', 'Editora LL', '2000-05-01', 10, 'Thriller', 19),('A Garota do Trem', 'Paula Hawkins', '9788574480394', 'Inglês', 'Editora MM', '2015-01-13', 10, 'Mistério', 20),('Garota Exemplar', 'Gillian Flynn', '9788574480400', 'Inglês', 'Editora NN', '2012-06-05', 10, 'Mistério', 20),('Sapiens: Uma Breve História da Humanidade', 'Yuval Noah Harari', '9788574480417', 'Hebraico', 'Editora OO', '2011-01-01', 10, 'Não Ficção', 21),('Breves Respostas para Grandes Questões', 'Stephen Hawking', '9788574480424', 'Inglês', 'Editora PP', '2018-10-16', 10, 'Ciência', 21),('Uma Breve História do Tempo', 'Stephen Hawking', '9788574480431', 'Inglês', 'Editora QQ', '1988-04-01', 10, 'Ciência', 22),('Cosmos', 'Carl Sagan', '9788574480448', 'Inglês', 'Editora RR', '1980-01-01', 10, 'Ciência', 22),('A História da Filosofia', 'Will Durant', '9788574480455', 'Inglês', 'Editora SS', '1926-05-01', 10, 'Filosofia', 23),('Ética a Nicômaco', 'Aristóteles', '9788574480462', 'Grego Antigo', 'Editora TT', '350-10-01', 10, 'Filosofia', 23),('O Príncipe', 'Nicolau Maquiavel', '9788574480479', 'Italiano', 'Editora UU', '1532-01-01', 10, 'Política', 24),('A Riqueza das Nações', 'Adam Smith', '9788574480486', 'Inglês', 'Editora VV', '1776-03-09', 10, 'Economia', 24),('Os Segredos da Mente Milionária', 'T. Harv Eker', '9788574480493', 'Inglês', 'Editora WW', '2005-01-01', 10, 'Autoajuda', 25),('Pai Rico, Pai Pobre', 'Robert Kiyosaki', '9788574480509', 'Inglês', 'Editora XX', '1997-04-01', 10, 'Finanças', 25),('A Arte de Lidar com Pessoas', 'Dale Carnegie', '9788574480516', 'Inglês', 'Editora YY', '1936-10-01', 10, 'Autoajuda', 26),('Mindset', 'Carol S. Dweck', '9788574480523', 'Inglês', 'Editora ZZ', '2006-02-28', 10, 'Psicologia', 26),('O Poder do Hábito', 'Charles Duhigg', '9788574480530', 'Inglês', 'Editora AAA', '2012-02-28', 10, 'Não Ficção', 27),('Rápido e Devagar', 'Daniel Kahneman', '9788574480547', 'Inglês', 'Editora BBB', '2011-10-25', 10, 'Psicologia', 27),('Fogo e Sangue', 'George R.R. Martin', '9788574480554', 'Inglês', 'Editora CCC', '2018-11-20', 10, 'Fantasia Épica', 28),('A Dança dos Dragões', 'George R.R. Martin', '9788574480561', 'Inglês', 'Editora DDD', '2011-07-12', 10, 'Fantasia Épica', 28),('A Estrada', 'Cormac McCarthy', '9788574480578', 'Inglês', 'Editora EEE', '2006-09-26', 10, 'Ficção Pós-Apocalíptica', 29),('O Lado Bom da Vida', 'Matthew Quick', '9788574480585', 'Inglês', 'Editora FFF', '2008-01-01', 10, 'Comédia Dramática', 29),('O Colecionador de Ossos', 'Jeffery Deaver', '9788574480592', 'Inglês', 'Editora GGG', '1997-01-01', 10, 'Thriller Policial', 30),('A Garota na Teia de Aranha', 'David Lagercrantz', '9788574480608', 'Sueco', 'Editora HHH', '2015-08-27', 10, 'Thriller', 30),('O Alquimista', 'Paulo Coelho', '9788574480615', 'Português', 'Editora III', '1988-01-01', 10, 'Ficção Espiritual', 31),('Ensaio sobre a Cegueira', 'José Saramago', '9788574480622', 'Português', 'Editora JJJ', '1995-01-01', 10, 'Romance', 31),('Memórias Póstumas de Brás Cubas', 'Machado de Assis', '9788574480639', 'Português', 'Editora KKK', '1881-01-01', 10, 'Clássico Brasileiro', 32),('Grande Sertão: Veredas', 'Guimarães Rosa', '9788574480646', 'Português', 'Editora LLL', '1956-01-01', 10, 'Clássico Brasileiro', 32),('Capitães da Areia', 'Jorge Amado', '9788574480653', 'Português', 'Editora MMM', '1937-01-01', 10, 'Ficção Social', 33),('O Tempo e o Vento: O Continente', 'Erico Veríssimo', '9788574480660', 'Português', 'Editora NNN', '1949-01-01', 10, 'Romance Histórico', 33),('Macunaíma', 'Mário de Andrade', '9788574480677', 'Português', 'Editora OOO', '1928-01-01', 10, 'Modernismo', 34),('Clara dos Anjos', 'Lima Barreto', '9788574480684', 'Português', 'Editora PPP', '1948-01-01', 10, 'Romance', 34),('O Alienista', 'Machado de Assis', '9788574480691', 'Português', 'Editora QQQ', '1882-01-01', 10, 'Ficção Psicológica', 35),('A Hora da Estrela', 'Clarice Lispector', '9788574480707', 'Português', 'Editora RRR', '1977-01-01', 10, 'Ficção Existencial', 35),('O Guarani', 'José de Alencar', '9788574480714', 'Português', 'Editora SSS', '1857-01-01', 10, 'Romantismo', 36),('Iracema', 'José de Alencar', '9788574480721', 'Português', 'Editora TTT', '1865-01-01', 10, 'Romantismo', 36),('A Casa dos Espíritos', 'Isabel Allende', '9788574480738', 'Espanhol', 'Editora UUU', '1982-01-01', 10, 'Realismo Mágico', 37),('Como Água Para Chocolate', 'Laura Esquivel', '9788574480745', 'Espanhol', 'Editora VVV', '1989-01-01', 10, 'Realismo Mágico', 37),('O Nome da Rosa', 'Umberto Eco', '9788574480752', 'Italiano', 'Editora WWW', '1980-01-01', 10, 'Romance Histórico', 38),('Drácula', 'Bram Stoker', '9788574480769', 'Inglês', 'Editora XXX', '1897-05-26', 10, 'Terror Gótico', 38),('Frankenstein', 'Mary Shelley', '9788574480776', 'Inglês', 'Editora YYY', '1818-01-01', 10, 'Ficção Gótica', 39),('O Estranho Caso de Dr. Jekyll e Mr. Hyde', 'Robert Louis Stevenson', '9788574480783', 'Inglês', 'Editora ZZZ', '1886-01-05', 10, 'Ficção Gótica', 39),('A Guerra dos Mundos', 'H.G. Wells', '9788574480790', 'Inglês', 'Editora AAAA', '1898-01-01', 10, 'Ficção Científica', 40),('A Máquina do Tempo', 'H.G. Wells', '9788574480806', 'Inglês', 'Editora BBBB', '1895-01-01', 10, 'Ficção Científica', 40),('Blade Runner: Androides Sonham com Ovelhas Elétricas?', 'Philip K. Dick', '9788574480813', 'Inglês', 'Editora CCCC', '1968-01-01', 10, 'Ficção Científica', 41),('Laranja Mecânica', 'Anthony Burgess', '9788574480820', 'Inglês', 'Editora DDDD', '1962-01-01', 10, 'Distopia', 41),('Cujo', 'Stephen King', '9788574480837', 'Inglês', 'Editora EEEE', '1981-09-08', 10, 'Terror', 42),('O Iluminado', 'Stephen King', '9788574480844', 'Inglês', 'Editora FFFF', '1977-01-28', 10, 'Terror', 42),('IT: A Coisa', 'Stephen King', '9788574480851', 'Inglês', 'Editora GGGG', '1986-09-15', 10, 'Terror', 43),('Carrie, a Estranha', 'Stephen King', '9788574480868', 'Inglês', 'Editora HHHH', '1974-04-05', 10, 'Terror', 43),('Psicopata Americano', 'Bret Easton Ellis', '9788574480875', 'Inglês', 'Editora IIII', '1991-01-01', 10, 'Ficção de Terror', 44),('O Silêncio dos Inocentes', 'Thomas Harris', '9788574480882', 'Inglês', 'Editora JJJJ', '1988-05-01', 10, 'Thriller', 44),('A Cabana', 'William P. Young', '9788574480899', 'Inglês', 'Editora KKKK', '2007-05-01', 10, 'Ficção Religiosa', 45),('A Última Música', 'Nicholas Sparks', '9788574480905', 'Inglês', 'Editora LLLL', '2009-09-08', 10, 'Romance', 45),('Como Eu Era Antes de Você', 'Jojo Moyes', '9788574480912', 'Inglês', 'Editora MMMM', '2012-01-05', 10, 'Romance', 46),('A Biblioteca da Meia-Noite', 'Matt Haig', '9788574480929', 'Inglês', 'Editora NNNN', '2020-08-13', 10, 'Ficção Contemporânea', 46),('Pachinko', 'Min Jin Lee', '9788574480936', 'Coreano', 'Editora OOOO', '2017-02-07', 10, 'Ficção Histórica', 47),('O Nome da Rosa', 'Umberto Eco', '9788574480943', 'Italiano', 'Editora PPPP', '1980-01-01', 10, 'Mistério', 47),('O Diário de Anne Frank', 'Anne Frank', '9788574480950', 'Holandês', 'Editora QQQQ', '1947-06-25', 10, 'Diário/Guerra', 48),('Noite', 'Elie Wiesel', '9788574480967', 'Hebraico', 'Editora RRRR', '1960-01-01', 10, 'Memórias/Guerra', 48),('A Menina que Roubava Livros', 'Markus Zusak', '9788574480974', 'Alemão', 'Editora SSSS', '2005-03-01', 10, 'Ficção Histórica', 49),('O Pianista', 'Władysław Szpilman', '9788574480981', 'Polonês', 'Editora TTTT', '1946-01-01', 10, 'Memórias/Guerra', 49),('Fique Comigo', 'Ayòbámi Adébáyò', '9788574480998', 'Inglês', 'Editora UUUU', '2017-03-07', 10, 'Ficção Africana', 50),('Americanah', 'Chimamanda Ngozi Adichie', '9788574481001', 'Inglês', 'Editora VVVV', '2013-05-14', 10, 'Ficção Contemporânea', 50),('A Cor Púrpura', 'Alice Walker', '9788574481018', 'Inglês', 'Editora WWWW', '1982-01-01', 10, 'Ficção Social', 51),(' Beloved', 'Toni Morrison', '9788574481025', 'Inglês', 'Editora XXXX', '1987-09-01', 10, 'Ficção Histórica', 51),('Os Filhos de Anansi', 'Neil Gaiman', '9788574481032', 'Inglês', 'Editora YYYY', '2005-09-20', 10, 'Fantasia Urbana', 52),('Deuses Americanos', 'Neil Gaiman', '9788574481049', 'Inglês', 'Editora ZZZZ', '2001-06-19', 10, 'Fantasia Urbana', 52),('Mitologia Nórdica', 'Neil Gaiman', '9788574481056', 'Inglês', 'Editora AAAAA', '2017-02-07', 10, 'Mitologia', 53),('Circe', 'Madeline Miller', '9788574481063', 'Inglês', 'Editora BBBBB', '2018-04-10', 10, 'Mitologia', 53),('O Labirinto do Fauno', 'Guillermo del Toro', '9788574481070', 'Espanhol', 'Editora CCCCC', '2006-10-06', 10, 'Fantasia Sombria', 54),('O Mundo de Sofia', 'Jostein Gaarder', '9788574481087', 'Norueguês', 'Editora DDDDD', '1991-01-01', 10, 'Filosofia', 54),('Introdução à Programação com Python', 'Nilo N. C. Menezes', '9788574481094', 'Português', 'Editora EEEEE', '2014-01-01', 10, 'Tecnologia', 55),('Clean Code', 'Robert C. Martin', '9788574481100', 'Inglês', 'Editora FFFFF', '2008-08-01', 10, 'Tecnologia', 55),('Pense em C', 'Allen B. Downey', '9788574481117', 'Inglês', 'Editora GGGGG', '2013-05-01', 10, 'Tecnologia', 56),('Algoritmos e Estruturas de Dados', 'Thomas H. Cormen', '9788574481124', 'Inglês', 'Editora HHHHH', '2009-01-01', 10, 'Tecnologia', 56),('A Arte da Guerra', 'Sun Tzu', '9788574481131', 'Chinês', 'Editora IIIII', '500-01-01', 10, 'Estratégia', 57),('O Livro dos Cinco Anéis', 'Miyamoto Musashi', '9788574481148', 'Japonês', 'Editora JJJJJ', '1645-01-01', 10, 'Estratégia', 57),('As Obras de Platão: Apologia de Sócrates', 'Platão', '9788574481155', 'Grego Antigo', 'Editora KKKKK', '399-01-01', 10, 'Filosofia', 58),('A República', 'Platão', '9788574481162', 'Grego Antigo', 'Editora LLLLL', '380-01-01', 10, 'Filosofia', 58),('História de Roma', 'Tito Lívio', '9788574481179', 'Latim', 'Editora MMMMM', '27-01-01', 10, 'História', 59),('Guerra Gálica', 'Júlio César', '9788574481186', 'Latim', 'Editora NNNNN', '58-01-01', 10, 'História', 59),('Sutil Arte de Ligar o F*da-se', 'Mark Manson', '9788574481193', 'Inglês', 'Editora OOOOO', '2016-09-13', 10, 'Autoajuda', 60),('Seja Foda!', 'Caio Carneiro', '9788574481209', 'Português', 'Editora PPPPP', '2017-04-12', 10, 'Autoajuda', 60);

